# 无花果

本系统用于实现一套收集数据并进行处理和分析的软件。

## 需求

很多商业都通过一定的手段收集客户或者合作伙伴的信息，并对数据进行检查以及进一步的处理和分析。

通常这种需求使用问卷系统解决，但是问卷系统的功能往往比较单一，只能实现简单的数据收集，无法对数据的进行校验以及进行运算。

使用问卷收集到的数据通常是离散的，不同阶段创建的不同问卷，虽然再业务场景上是相同的，但是因为创建的问卷发生变化，无法统一处理。
普通的问卷系统不会对数据的有效性进行校验，用户提交的数据很有可能是混乱无序的，难以进行分析。

问卷中的字段通常只有一些是否必填的关联，难以实现计算逻辑的关联。

问卷之间也没有上下游的关系，无法跟着业务的进展流转。

## 功能

### 词汇表

词汇表用于对业务中的关键概念进行定义，以对系统中要处理的数据含义进行统一。

词汇的定义包含名称、数据类型、含义解析、校验约束等，同时词汇也可以是复合的，可以通过定义属性并对属性进行定义来描述词汇。

另外，因为词汇在不同的上下文中可能存在不同的释义，所以需要对词汇添加标签进行区分。

### 数据定义

数据定义功能用来定义要收集的数据的格式的，对要收集的信息进行规范，通过定义描述概念的属性，并添加检查约束，以支持后续的数据收集和分析。

数据定义应该包含名称、属性定义、释义以及校验约束等。

为了实现计算逻辑，可以在数据定义的某些属性中配置计算表达式，这些配置了表达式的属性则通过上下文中的其他数据计算得到，而不是用户填写得到。

### 表单设计

在数据格式定义完成后，便可以进行数据收集。但是为了更好的展示收集数据的表单，还需要对表单的外观进行控制。

### 流程设计

今天的数据收集只需要通过表单收集数据就可以了，更加复杂的业务则需要创建流程进行控制，在流程中根据不同的条件流转一份或者多份表单，最终将需要的数据收集完成。

### 数据分析

数据分析功能是对收集到的数据进行进一步的处理，通过数据之间的关系和规律得到更有价值的数据。

## 实现

### 数据定义

词汇表和数据定义在定义方面的功能没有什么差别，都是元数据定义，统一使用 json-schema 进行定义。设计成两个功能是为了对业务场景进行划分，首先要对领域内的概念进行清晰的定义，然后通过这些概念的排列组合，创建出要收集和处理的数据定义集合。

数据定义功能和词汇表功能的一个区别是需要实现计算值，需要在属性上配置表达式，这时要对 json-schema 进行扩展，添加自定义的定义。

### 表达式

实现表达式功能的方法有很多，最容易想到的是编写 JavaScript ES5 代码，然后交由解释器执行，可用的选型是[JS-Interpreter](https://github.com/NeilFraser/JS-Interpreter)。

### 表单设计

为了使用定义好的数据格式创建出表单，需要使用自动生成表单的库，首选的是[json-forms](https://jsonforms.io/)。json-forms 可以借助 json-schame 和 ui-schema 创建符合需求的表单。

### 流程设计

流程设计可用的选型较多，比较推荐的是[Camunda](https://camunda.com/)，前端可以借助[bpmn-js](https://bpmn.io/toolkit/bpmn-js/)实现流程定义。
