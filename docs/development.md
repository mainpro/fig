# 开发文档

## 技术栈

### 数据定义

词汇表与数据定义同属元数据定义范畴，均采用 JsonSchema 进行标准化定义。
二者功能区分旨在适配不同业务场景：先利用词汇表明确领域概念，再基于概念组合构建数据定义集合。
数据定义功能在实现计算值时，需对 JsonSchema 进行扩展，添加自定义定义，以支持属性表达式配置。
这种标准化与可扩展的定义方式，使得在系统搭建初期，能够快速复用已有元数据模板，实现简单业务的数据定义；
当业务迭代时，方便对元数据进行修改和扩展，保障数据定义与业务发展同步。

### 表达式

表达式功能实现方式多样，其中编写 JavaScript ES5 代码并借助解释器执行是可行方案之一，[JS-Interpreter](https://github.com/NeilFraser/JS-Interpreter)可作为参考选型。
通过这种方式，无论是简单业务中的基础数据计算，还是复杂业务中的复杂逻辑运算，都能通过编写、修改表达式实现。
在业务迭代过程中，可随时更新表达式逻辑，快速响应业务规则的变化。

### 表单设计

为实现数据格式到表单的自动转换，推荐使用[json-forms](https://jsonforms.io/)库。
该库可基于 JsonSchema 和 ui-schema 快速生成符合需求的表单，简化表单设计流程，提高开发效率。
在系统搭建时，可利用其模板和配置功能，迅速生成适配简单业务的表单；
随着业务演进，通过修改 JsonSchema 和 UISchema 参数，就能实现表单的功能升级与样式优化。

### 流程设计

流程设计领域可选方案丰富，[Camunda](https://camunda.com/)是较为推荐的工具，前端配合[bpmn-js](https://bpmn.io/toolkit/bpmn-js/)可高效实现流程定义，满足复杂业务流程设计需求。
在项目初期，可使用其基础功能快速搭建简易流程；
当业务变得复杂时，借助其强大的流程编排和管理能力，通过可视化操作对流程进行重构、优化，轻松实现从简单流程到复杂流程的迭代升级。

## 开发计划

### 数据建模

- 实现词汇表列表和详情页面
- 实现数据结构列表和详情页面
- 为词汇表和数据结构添加标签功能
- 前后端引入 JsonSchema 类型
- 数据结构实现表达式配置功能
- 实现函数的引用

### 表单设计

- 实现配置表单的功能
- 实现表单的图形化编辑

### 逻辑开发

- 实现函数列表和详情页面
- 实现函数的图形化编辑
- 实现函数调试能力

### 流程编排

- 实现流程编排页面
- 实现自定义执行节点
- 开发自定义节点配置页面
- 执行配置好的流程

### 页面设计

- 实现应用的配置
- 实现功能的配置
- 实现页面的配置

## 快速开始

### 后端

本项目后端使用`gradle`构建，请确保你安装了大于 17 版本的`jdk`，执行下面的命令进行构建。

```shell
# 切换到后端目录
cd server
# 如果使用windows系统，使用"./gradlew.bat"代替"./gradlew"
./gradlew clean build -x test
```

你可以使用下面的命令启动后端服务器。

```shell
# 接换到后端目录
cd server
# 启动服务器，将version更换为版本号
java -jar ./build/libs/fig-version.jar
```

### 前端

本项目前端使用`vite`构建，请确保你已经安装了大于 22 版本的`node`运行环境，执行下面的命令进行构建。

```shell
# 切换到前端目录
cd client
# 如果是第一次构建，需要先安装依赖
yarn install
# 确保已经正确安装依赖后，执行构建
yarn build
```

如果要启动调试服务器，执行下面的命令。

```shell
# 切换到前端目录
cd client
# 启动调试服务器
yarn dev
```

启动调试服务器后，访问`http://localhost:5173`打开服务，默认用户名 username，默认密码 password，正式发布时请修改用户名和密码。

### 容器化

如果你需要使用容器启动项目，我们也为你准备了构建配置和运行配置。`server`目录和`client`目录中均已包含 Dockerfile，同时我们也在构建工具中添加了构建命令。

在开始使用镜像启动服务前，请确定你已经正确安装了`docker`和`docker-compose`， 我们开发环境使用`docker desktop`安装。

使用下面的命令构建后端服务的镜像。

```shell
# 进入后端目录
cd server
# 执行构建命令
./gradlew buildImage
# 检查容器镜像
docker image ls
```

使用下面的命令构建前端服务的镜像。

```shell
# 进入前端目录
cd client
# 执行构建命令
yarn build:image
# 检查容器镜像
docker image ls
```

容器构建完成后，你可以使用根目录的`docker-compose`配置文件启动服务，你可以修改`.env`中的配置。

```shell
# 启动多个服务
docker compose up -d
```

启动后访问`https://localhost:3000`,默认用户名 username，默认密码 password。默认用户名密码仅用于调试，正式发布时请修改用户名和密码。
